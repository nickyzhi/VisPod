<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<title>jsdifflib demo</title>
	<link href='https://fonts.googleapis.com/css?family=Hind:400,700,600' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="export/Dropit-master/dropit.css" type="text/css" />
	<link href='https://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="diffview.css"/>
	<link rel="stylesheet" type="text/css" href="analyze.css"/>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
	<script src="export/Dropit-master/dropit.js"></script>
	<script type="text/javascript" src="diffview.js"></script>
	<script type="text/javascript" src="difflib.js"></script>
	<script type="text/javascript" src="analyze.js"></script>
	<script src="//d3js.org/d3.v3.min.js"></script>
	<script type="text/javascript" src="export/tableExport.js"></script>
	<script type="text/javascript" src="export/jquery.base64.js"></script>
	<script type="text/javascript" src="export/jspdf/libs/sprintf.js"></script>
	<script type="text/javascript" src="export/jspdf/jspdf.js"></script>
	<script type="text/javascript" src="export/jspdf/libs/base64.js"></script>
	<script type="text/javascript" src="export/html2canvas.js"></script>
<style type="text/css">
.menu ul{display:none;}.menu ul.dropit-submenu{background-color:#fff;border:1px solid #b2b2b2;padding:6px 0;margin:3px 0 0 1px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;-webkit-box-shadow:0px 1px 3px rgba(0,0,0,0.15);-moz-box-shadow:0px 1px 3px rgba(0,0,0,0.15);box-shadow:0px 1px 3px rgba(0,0,0,0.15);}.menu ul.dropit-submenu a{display:block;font-size:14px;line-height:25px;color:#7a868e;padding:0 18px;}.menu ul.dropit-submenu a:hover{background:#248fc1;color:#fff;text-decoration:none;}
body {
	font-size: 12px;
	font-family: Sans-Serif;
	background-image:url(wQQ3Ab.png);background-repeat:repeat-x;
}
#plusText, #minusText, #maxSubstringContent, #basetxtContent, #newtxtContent, #similarPercentage{
	cursor: pointer;
}
</style>

<script type="text/javascript">


function diffUsingJS() {
	"use strict";
	var byId = function (id) { return document.getElementById(id); },
		base = difflib.stringAsLines(byId("baseText").value),
		newtxt = difflib.stringAsLines(byId("newText").value),
		sm = new difflib.SequenceMatcher(base, newtxt),
		opcodes = sm.get_opcodes(),
		diffoutputdiv = byId("diffoutput"),
		contextSize = "300";

	diffoutputdiv.innerHTML = "";
	contextSize = '500';

	diffoutputdiv.appendChild(diffview.buildView({
		baseTextLines: base,
		newTextLines: newtxt,
		opcodes: opcodes,
		baseTextName: "Base Text",
		newTextName: "New Text",
		contextSize: contextSize
	}));
}

</script>
</head>
<body>
	<h1 class="top">Diff++ Tool</h1>
		<table id="center"  style="text-align:center;">
			<tr class = "title">
				<td colspan="2">Statistical Result</td>
			</tr>
			<tr class = "newtxt">
				<td>Gold Result</td>
				<td id="newtxtContent" title = "This is gold result"></td>
			</tr>
			<tr class = "basetxt">
				<td>Machine Output</td>
				<td id="basetxtContent" title = "This is machine output result"></td>
			</tr>
			<tr class = "maxSubstring">
				<td>Maximum Same Substring</td>
				<td id="maxSubstringContent" title="This is the maximum same substring between machine output and gold result"></td>
			</tr>
			<tr class = "basetxtDiff">
				<td rowspan="2">Machine Output Difference</td>
				<td id="plusText" title="&quot;+&quot;means redundant words in machine output result"></td>
			</tr>
			<tr class = "basetxtDiff">
				<td id="minusText" title="&quot;-&quot;means missing words in machine output result"></td>
			</tr>
			<tr class = "similar">
				<td>Similarity Score</td>
				<td id="similarPercentage" title="This is the percentage of similar text between machine output and gold result"></td>
			</tr>
		</table>

	<ul class="menu">
	    <li>
	        <a href="#">Export Table</a>
	        <ul>
	            <li><a href="#" onclick="$('#center').tableExport({type:'json',escape:'false'});">json</a></li>
	            <li><a href="#" onclick="$('#center').tableExport({type:'png',escape:'false'});">png</a></li>
	            <li><a href="#" onclick="$('#center').tableExport({type:'pdf',pdfFontSize:'7',escape:'false'});">pdf</a></li>
	            <li><a href="#" onclick="$('#center').tableExport({type:'csv',escape:'false'});">csv</a></li>
	        </ul>
	    </li>
	</ul>

	<div id = "pie">

	</div>
	<div id="sankey">
	</div>


	<script>
		var a = sessionStorage.getItem("text1");
		var b = sessionStorage.getItem("text2");
		var plus = [];
		var minus = [];
		var maxSubstring = findMaxSubStr(a,b);
		[plus,minus] = diff(a,b);
		similar = similarity(a,b);
		percentage = similar.toFixed(2);
		diffnumber = (1-percentage).toFixed(2);
		similarPercentage = percentage.slice(2,4)+"%"; 
		diffPercentage = diffnumber.slice(2,4)+"%"; 
		//str = test.get_matching_blocks();
		document.getElementById("basetxtContent").innerHTML=a;
		document.getElementById("newtxtContent").innerHTML=b;
		document.getElementById("maxSubstringContent").innerHTML=maxSubstring;
		document.getElementById("plusText").innerHTML="+   "+plus;
		document.getElementById("minusText").innerHTML="-   "+minus;
		document.getElementById("similarPercentage").innerHTML=percentage;

		// generate json data format
		var dataset = [{label:"same("+similarPercentage+")", percentage:similar}, {label:"diff("+diffPercentage+")",percentage: 1-similar}];
		//drw pie chart
		var pie = piechart(dataset);

	    var dataset1 = a.split(" ");
	    var dataset2 = b.split(" ");
	    var sankey = simpleSankey(dataset1,dataset2);
	    
	</script>


</body>
</html>
